name: Validate Blob Storage Connectivity

on:
  workflow_dispatch:

jobs:
  test-blob:
    runs-on: ubuntu-latest

    steps:
      - name: Show runner public IP
        run: |
          echo "Runner IP:"
          curl -s https://api.ipify.org
          echo ""

      - name: Test DNS resolution
        run: |
          nslookup 21312wsaasas.blob.core.windows.net

      - name: Test TCP connectivity (443)
        run: |
          timeout 5 bash -c "</dev/tcp/21312wsaasas.blob.core.windows.net/443" \
          && echo "TCP OK" \
          || (echo "TCP FAILED" && exit 1)

      - name: Install Azure CLI
        run: |
          curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash

      - name: List blobs using SAS
        run: |
          az storage blob list \
            --account-name 21312wsaasas \
            --container-name testeasd \
            --sas-token "sv=2024-11-04&ss=b&srt=sco&sp=rltfx&se=2027-02-27T14:50:19Z&st=2026-02-27T06:35:19Z&spr=https&sig=MX8p4xrnvTgCXJaY8VRT2TaW4htpoQW8h0Mld9oS0Io%3D" \
            --output table
